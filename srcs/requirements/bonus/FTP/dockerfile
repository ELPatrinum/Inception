FROM debian:buster

# Install vsftpd and clean up
RUN apt-get update && apt-get upgrade -y && \
    apt-get install -y vsftpd && \
    apt-get clean

# Copy the script and make it executable
COPY ./tools/script.sh /tmp/script.sh
RUN chmod +x /tmp/script.sh

# Configure vsftpd
RUN echo 'anonymous_enable=NO' >> /etc/vsftpd.conf && \
    echo 'local_enable=YES' >> /etc/vsftpd.conf && \
    echo 'write_enable=YES' >> /etc/vsftpd.conf && \
    echo 'chroot_local_user=YES' >> /etc/vsftpd.conf && \
    echo 'allow_writeable_chroot=YES' >> /etc/vsftpd.conf && \
    echo 'pasv_min_port=40000' >> /etc/vsftpd.conf && \
    echo 'pasv_max_port=40005' >> /etc/vsftpd.conf && \
    echo 'userlist_enable=YES' >> /etc/vsftpd.conf && \
    echo 'userlist_file=/etc/vsftpd.userlist' >> /etc/vsftpd.conf && \
    echo 'userlist_deny=NO' >> /etc/vsftpd.conf

# Expose FTP ports
EXPOSE 21 40000-40005

# Set the entrypoint and default command
ENTRYPOINT ["/tmp/script.sh"]
CMD ["/usr/sbin/vsftpd", "/etc/vsftpd.conf"]
